"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8574],{68574:(pe,x,g)=>{g.r(x),g.d(x,{Tab1PageModule:()=>me});var h=g(11929),T=g(96814),v=g(60095),L=g(23554),P=g(96116),w=g(15861),k=g(66588),A=g(22832),Z=g(74825),n=g(85678),Q=g(59634),U=g(97582),J=g(65592),F=g(92438),z={error:"cordova_not_available"},N={error:"plugin_not_installed"};function y(t){if(typeof window<"u"&&window.angular){var i=window.document,e=window.angular.element(i.querySelector("[ng-app]")||i.body).injector();if(e)return e.get("$q")(function(c,o){t(c,o)});console.warn("Angular 1 was detected but $q couldn't be retrieved. This is usually when the app is not bootstrapped on the html or body tag. Falling back to native promises which won't trigger an automatic digest when promises resolve.")}return function(){if(Promise)return new Promise(function(c,o){t(c,o)});console.error("No Promise support or polyfill found. To enable Ionic Native support, please add the es6-promise polyfill before this script, or run with a library like Angular or on a recent browser.")}()}function C(t,r,i){var e,a,c;return"string"==typeof t?e=t:(e=t.constructor.getPluginRef(),i=t.constructor.getPluginName(),c=t.constructor.getPluginInstallName()),!(!(a=q(e))||r&&typeof a[r]>"u")||(typeof window>"u"||!window.cordova?(function Y(t,r){typeof process>"u"&&console.warn(r?"Native: tried calling "+t+"."+r+", but Cordova is not available. Make sure to include cordova.js or run in a device/simulator":"Native: tried accessing the "+t+" plugin but Cordova is not available. Make sure to include cordova.js or run in a device/simulator")}(i,r),z):(function W(t,r,i){console.warn(i?"Native: tried calling "+t+"."+i+", but the "+t+" plugin is not installed.":"Native: tried accessing the "+t+" plugin but it's not installed."),r&&console.warn("Install the "+t+" plugin: 'ionic cordova plugin add "+r+"'")}(i,c,r),N))}function _(t,r,i,e,a,c){void 0===e&&(e={}),i=function I(t,r,i,e){if(void 0===r&&(r={}),r.sync)return t;if("reverse"===r.callbackOrder)t.unshift(e),t.unshift(i);else if("node"===r.callbackStyle)t.push(function(u,l){u?e(u):i(l)});else if("object"===r.callbackStyle&&r.successName&&r.errorName){var a={};a[r.successName]=i,a[r.errorName]=e,t.push(a)}else if(typeof r.successIndex<"u"||typeof r.errorIndex<"u"){var c=function(){r.successIndex>t.length?t[r.successIndex]=i:t.splice(r.successIndex,0,i)},o=function(){r.errorIndex>t.length?t[r.errorIndex]=e:t.splice(r.errorIndex,0,e)};r.successIndex>r.errorIndex?(o(),c()):(c(),o())}else t.push(i),t.push(e);return t}(i,e,a,c);var o=C(t,r);if(!0===o){var u=q(t.constructor.getPluginRef());return u[r].apply(u,i)}return o}function q(t){return typeof window<"u"?R(window,t):null}function R(t,r){for(var i=r.split("."),e=t,a=0;a<i.length;a++){if(!e)return null;e=e[i[a]]}return e}var X=function(){function t(){}return t.installed=function(){return!0===C(this.pluginRef)},t.getPlugin=function(){return typeof window<"u"?function K(t,r){for(var i=r.split("."),e=t,a=0;a<i.length;a++){if(!e)return null;e=e[i[a]]}return e}(window,this.pluginRef):null},t.getPluginName=function(){return this.pluginName},t.getPluginRef=function(){return this.pluginRef},t.getPluginInstallName=function(){return this.plugin},t.getSupportedPlatforms=function(){return this.platforms},t.pluginName="",t.pluginRef="",t.plugin="",t.repo="",t.platforms=[],t.install="",t}();!function M(){if(typeof process>"u"){var t=typeof window<"u"?window:{},i=Date.now(),e=!1;t.document.addEventListener("deviceready",function(){console.log("Ionic Native: deviceready event fired after "+(Date.now()-i)+" ms"),e=!0}),setTimeout(function(){!e&&t.cordova&&console.warn("Ionic Native: deviceready did not fire within 5000ms. This can happen when plugins are in an inconsistent state. Try removing plugins from plugins/ and reinstalling them.")},5e3)}}();var S=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return(0,U.ZT)(r,t),r.prototype.vibrate=function(i){return function O(t,r,i,e){return function(t,r,i){return void 0===i&&(i={}),function(){for(var e=[],a=0;a<arguments.length;a++)e[a]=arguments[a];return i.sync?_(t,r,e,i):i.observable?function G(t,r,i,e){return void 0===e&&(e={}),new J.y(function(a){var c;return c=e.destruct?_(t,r,i,e,function(){for(var o=[],u=0;u<arguments.length;u++)o[u]=arguments[u];return a.next(o)},function(){for(var o=[],u=0;u<arguments.length;u++)o[u]=arguments[u];return a.error(o)}):_(t,r,i,e,a.next.bind(a),a.error.bind(a)),c&&c.error&&(a.error(c.error),a.complete()),function(){try{if(e.clearFunction)return e.clearWithArgs?_(t,e.clearFunction,i,e,a.next.bind(a),a.error.bind(a)):_(t,e.clearFunction,[])}catch(o){console.warn("Unable to clear the previous observable watch for",t.constructor.getPluginName(),r),console.warn(o)}}})}(t,r,e,i):i.eventObservable&&i.event?function H(t,r){return r=typeof window<"u"&&r?R(window,r):r||(typeof window<"u"?window:{}),(0,F.R)(r,t)}(i.event,i.element):i.otherPromise?function D(t,r,i,e){return void 0===e&&(e={}),y(function(a,c){var o=_(t,r,i,e);o?o.error?c(o.error):o.then&&o.then(a).catch(c):c({error:"unexpected_error"})})}(t,r,e,i):function $(t,r,i,e){void 0===e&&(e={});var a,c,o=y(function(u,l){a=e.destruct?_(t,r,i,e,function(){for(var f=[],s=0;s<arguments.length;s++)f[s]=arguments[s];return u(f)},function(){for(var f=[],s=0;s<arguments.length;s++)f[s]=arguments[s];return l(f)}):_(t,r,i,e,u,l),c=l});return a&&a.error&&(o.catch(function(){}),"function"==typeof c&&c(a.error)),o}(t,r,e,i)}}(t,r,i).apply(this,e)}(this,"vibrate",{sync:!0},arguments)},r.pluginName="Vibration",r.plugin="cordova-plugin-vibration",r.pluginRef="navigator",r.repo="https://github.com/apache/cordova-plugin-vibration",r.platforms=["Android","iOS","Windows"],r.decorators=[{type:n.GSi}],r}(X),ee=g(17911),b=g(28251),te=g(6593);const ne=["qrcElement"];let re=(()=>{var t;class r{constructor(e,a){this.renderer=e,this.sanitizer=a,this.allowEmptyString=!1,this.colorDark="#000000ff",this.colorLight="#ffffffff",this.cssClass="qrcode",this.elementType="canvas",this.errorCorrectionLevel="M",this.margin=4,this.qrdata="",this.scale=4,this.width=10,this.qrCodeURL=new n.vpe,this.context=null}ngOnChanges(){var e=this;return(0,w.Z)(function*(){yield e.createQRCode()})()}isValidQrCodeText(e){return!1===this.allowEmptyString?!(typeof e>"u"||""===e||"null"===e||null===e):!(typeof e>"u")}toDataURL(e){return new Promise((a,c)=>{(0,b.toDataURL)(this.qrdata,e,(o,u)=>{o?c(o):a(u)})})}toCanvas(e,a){return new Promise((c,o)=>{(0,b.toCanvas)(e,this.qrdata,a,u=>{u?o(u):c("success")})})}toSVG(e){return new Promise((a,c)=>{(0,b.toString)(this.qrdata,e,(o,u)=>{o?c(o):a(u)})})}renderElement(e){for(const a of this.qrcElement.nativeElement.childNodes)this.renderer.removeChild(this.qrcElement.nativeElement,a);this.renderer.appendChild(this.qrcElement.nativeElement,e)}createQRCode(){var e=this;return(0,w.Z)(function*(){e.version&&e.version>40?(console.warn("[angularx-qrcode] max value for `version` is 40"),e.version=40):e.version&&e.version<1?(console.warn("[angularx-qrcode]`min value for `version` is 1"),e.version=1):void 0!==e.version&&isNaN(e.version)&&(console.warn("[angularx-qrcode] version should be a number, defaulting to auto."),e.version=void 0);try{if(!e.isValidQrCodeText(e.qrdata))throw new Error("[angularx-qrcode] Field `qrdata` is empty, set 'allowEmptyString=\"true\"' to overwrite this behaviour.");e.isValidQrCodeText(e.qrdata)&&""===e.qrdata&&(e.qrdata=" ");const a={color:{dark:e.colorDark,light:e.colorLight},errorCorrectionLevel:e.errorCorrectionLevel,margin:e.margin,scale:e.scale,version:e.version,width:e.width},c=e.imageSrc,o=e.imageHeight||40,u=e.imageWidth||40;switch(e.elementType){case"canvas":{const l=e.renderer.createElement("canvas");e.context=l.getContext("2d"),e.toCanvas(l,a).then(()=>{if(e.ariaLabel&&e.renderer.setAttribute(l,"aria-label",`${e.ariaLabel}`),e.title&&e.renderer.setAttribute(l,"title",`${e.title}`),c&&e.context){e.centerImage=new Image(u,o),c!==e.centerImage.src&&(e.centerImage.src=c),o!==e.centerImage.height&&(e.centerImage.height=o),u!==e.centerImage.width&&(e.centerImage.width=u);const f=e.centerImage;f&&(f.onload=()=>{var s;null===(s=e.context)||void 0===s||s.drawImage(f,l.width/2-u/2,l.height/2-o/2,u,o)})}e.renderElement(l),e.emitQRCodeURL(l)}).catch(f=>{console.error("[angularx-qrcode] canvas error:",f)});break}case"svg":{const l=e.renderer.createElement("div");e.toSVG(a).then(f=>{e.renderer.setProperty(l,"innerHTML",f);const s=l.firstChild;e.renderer.setAttribute(s,"height",`${e.width}`),e.renderer.setAttribute(s,"width",`${e.width}`),e.renderElement(s),e.emitQRCodeURL(s)}).catch(f=>{console.error("[angularx-qrcode] svg error:",f)});break}default:{const l=e.renderer.createElement("img");e.toDataURL(a).then(f=>{e.alt&&l.setAttribute("alt",e.alt),e.ariaLabel&&l.setAttribute("aria-label",e.ariaLabel),l.setAttribute("src",f),e.title&&l.setAttribute("title",e.title),e.renderElement(l),e.emitQRCodeURL(l)}).catch(f=>{console.error("[angularx-qrcode] img/url error:",f)})}}}catch(a){console.error("[angularx-qrcode] Error generating QR Code:",a.message)}})()}emitQRCodeURL(e){const a=e.constructor.name;if(a===SVGSVGElement.name){const u=new Blob([e.outerHTML],{type:"image/svg+xml"}),l=URL.createObjectURL(u),f=this.sanitizer.bypassSecurityTrustUrl(l);return void this.qrCodeURL.emit(f)}let c="";a===HTMLCanvasElement.name&&(c=e.toDataURL("image/png")),a===HTMLImageElement.name&&(c=e.src),fetch(c).then(o=>o.blob()).then(o=>URL.createObjectURL(o)).then(o=>this.sanitizer.bypassSecurityTrustUrl(o)).then(o=>{this.qrCodeURL.emit(o)}).catch(o=>{console.error("[angularx-qrcode] Error when fetching image/png URL: "+o)})}}return(t=r).\u0275fac=function(e){return new(e||t)(n.Y36(n.Qsj),n.Y36(te.H7))},t.\u0275cmp=n.Xpm({type:t,selectors:[["qrcode"]],viewQuery:function(e,a){if(1&e&&n.Gf(ne,7),2&e){let c;n.iGM(c=n.CRH())&&(a.qrcElement=c.first)}},inputs:{allowEmptyString:"allowEmptyString",colorDark:"colorDark",colorLight:"colorLight",cssClass:"cssClass",elementType:"elementType",errorCorrectionLevel:"errorCorrectionLevel",imageSrc:"imageSrc",imageHeight:"imageHeight",imageWidth:"imageWidth",margin:"margin",qrdata:"qrdata",scale:"scale",version:"version",width:"width",alt:"alt",ariaLabel:"ariaLabel",title:"title"},outputs:{qrCodeURL:"qrCodeURL"},features:[n.TTD],decls:2,vars:2,consts:[["qrcElement",""]],template:function(e,a){1&e&&n._UZ(0,"div",null,0),2&e&&n.Tol(a.cssClass)},encapsulation:2,changeDetection:0}),r})(),ie=(()=>{var t;class r{}return(t=r).\u0275fac=function(e){return new(e||t)},t.\u0275mod=n.oAB({type:t}),t.\u0275inj=n.cJS({}),r})();function ae(t,r){1&t&&(n.ynx(0),n.TgZ(1,"div",4)(2,"p",5),n._uU(3,"Please login to continue"),n.qZA()(),n.BQk())}function oe(t,r){if(1&t){const i=n.EpF();n.ynx(0),n.TgZ(1,"form",11),n.NdJ("ngSubmit",function(){n.CHM(i);const a=n.oxw(2);return n.KtG(a.lock_or_unlock())}),n._UZ(2,"ion-input",12),n.qZA(),n.BQk()}if(2&t){const i=n.oxw(2);n.xp6(1),n.Q6J("formGroup",i.myForm),n.xp6(1),n.s9C("errorText",i.qr_error)}}function ce(t,r){if(1&t&&(n.TgZ(0,"p",15),n._uU(1),n.qZA()),2&t){const i=n.oxw(3);n.xp6(1),n.hij("",i.qr_data," N")}}function le(t,r){if(1&t&&(n.ynx(0),n._UZ(1,"qrcode",13),n.YNc(2,ce,2,1,"p",14),n.BQk()),2&t){const i=n.oxw(2);n.xp6(1),n.Q6J("qrdata",i.qr_data)("elementType","img")("width",300),n.xp6(1),n.Q6J("ngIf",i.qr_finalized)}}function se(t,r){if(1&t){const i=n.EpF();n.ynx(0),n.TgZ(1,"ion-button",16),n.NdJ("click",function(){n.CHM(i);const a=n.oxw(2);return n.KtG(a.activate_receipt())}),n._UZ(2,"ion-icon",17),n.qZA(),n._UZ(3,"br"),n.TgZ(4,"span"),n._uU(5,"To display receipt when someone paid."),n.qZA(),n.BQk()}}function ue(t,r){if(1&t){const i=n.EpF();n.TgZ(0,"ion-toggle",20),n.NdJ("ionChange",function(){n.CHM(i);const a=n.oxw(3);return n.KtG(a.on_single_change())}),n._uU(1),n.qZA()}if(2&t){const i=n.oxw(3);n.Q6J("checked",i.is_single)("disabled",i.qr_finalized),n.xp6(1),n.hij(" ",i.is_single_name," ")}}function fe(t,r){if(1&t&&(n.TgZ(0,"span"),n._uU(1),n.qZA()),2&t){const i=n.oxw(3);n.xp6(1),n.Oqu(i.is_single_name)}}function de(t,r){if(1&t&&(n.ynx(0),n.YNc(1,ue,2,3,"ion-toggle",18)(2,fe,2,1,"span",3),n._UZ(3,"div",19),n.BQk()),2&t){const i=n.oxw(2);n.xp6(1),n.Q6J("ngIf",!i.qr_finalized),n.xp6(1),n.Q6J("ngIf",i.qr_finalized)}}function ge(t,r){if(1&t){const i=n.EpF();n.ynx(0),n.TgZ(1,"div",6)(2,"h3",7),n._uU(3),n.qZA()(),n.TgZ(4,"div",4),n.YNc(5,oe,3,2,"ng-container",3)(6,le,3,4,"ng-container",3),n.TgZ(7,"ion-button",8),n.NdJ("click",function(){n.CHM(i);const a=n.oxw();return n.KtG(a.lock_or_unlock())}),n._UZ(8,"ion-icon",9),n.qZA()(),n.TgZ(9,"div",10),n.YNc(10,se,6,0,"ng-container",3)(11,de,4,2,"ng-container",3),n.qZA(),n.BQk()}if(2&t){const i=n.oxw();n.xp6(3),n.hij(' Warning! Check payment destination: "',i.contract_id,'" '),n.xp6(2),n.Q6J("ngIf",!i.qr_finalized),n.xp6(1),n.Q6J("ngIf",i.qr_finalized),n.xp6(1),n.Q6J("color",i.lock_color),n.xp6(1),n.Q6J("name",i.lock_unlock_name),n.xp6(2),n.Q6J("ngIf",!i.receipt_activated),n.xp6(1),n.Q6J("ngIf",i.receipt_activated)}}const he=[{path:"",component:(()=>{var t;class r{constructor(e,a,c,o){this.fb=e,this.walletSvc=a,this.vibration=c,this.toastSvc=o,this.qr_finalized=!1,this.min_val=.001,this.max_val=5e7,this.single_interval=1500,this.receipt_activated=!0,this.is_single=!0,this.receipt_updated=!1,this.timeout_count=0,this.threshold_timeout=Math.round(200)}ngOnInit(){this.myForm=this.fb.group({price:[,[v.kI.required,v.kI.min(this.min_val),v.kI.max(this.max_val),v.kI.pattern("^[0-9]+(.[0-9]{0,5})?$")]]}),this.source=function E(t=0,r=A.z){return t<0&&(t=0),(0,Z.H)(t,t,r)}(this.single_interval),setTimeout(()=>this.refresh_fn(),1e3)}ngOnDestroy(){this.subscription.unsubscribe()}handle_refresh(e){var a=this;return(0,w.Z)(function*(){yield a.refresh_fn(),e.target.complete()})()}refresh_fn(){var e=this;return(0,w.Z)(function*(){e.receipt_activated=yield e.walletSvc.view("receipt_activated",{account:e.walletSvc.account_id})})()}get account_id(){var e;return null!==(e=this.walletSvc.account_id)&&void 0!==e?e:""}get contract_id(){return this.walletSvc.contract_id}get qr_data(){return`${this.account_id} ${this.myForm.get("price").value.toString()}`}get qr_error(){var e,a=null!==(e=this.myForm.get("price").errors)&&void 0!==e?e:{};return a.pattern?"Max 5 decimal place, numbers only.":a.min?`Minimum ${this.min_val} per transaction.`:a.max?`Maximum ${this.max_val} per transaction.`:null}get errors(){return this.myForm.get("price").errors}lock_or_unlock(){return this.errors?(this.myForm.get("price").markAsDirty(),this.toastSvc.present_toast(this.errors.required?"Please input price":`Error: ${this.qr_error}`,"top","bg-danger"),null):this.qr_finalized?this.unlock_price():this.lock_price()}get lock_unlock_name(){return this.qr_finalized?"lock-open-outline":"lock-closed-outline"}get lock_color(){return this.qr_finalized?"medium":"primary"}lock_price(){this.qr_finalized=!0,this.myForm.get("price").disable(),this.is_single&&(this.receipt_updated=!1,this.detect_receipt(),this.set_old_receipt())}unlock_price(){this.vibration.vibrate([300,500,800]),this.qr_finalized=!1,this.myForm.get("price").enable(),this.is_single&&this.stop_detect_receipt()}activate_receipt(){var e;this.walletSvc.call("activate_receipt",{},null!==(e=k.utils.format.parseNearAmount("0.1"))&&void 0!==e?e:"0")}get is_single_name(){return this.is_single?"Only one payment":"Accept multiple payments"}on_single_change(){this.is_single=!this.is_single}detect_receipt(){this.subscription=this.source.subscribe(e=>this._receipt_changed())}stop_detect_receipt(){this.old_receipt=null,this.receipt_updated=!1,this.timeout_count=0,this.subscription.unsubscribe()}_receipt_changed(){var e=this;return(0,w.Z)(function*(){if(console.log("receipt change called"),""===e.account_id)return e.toastSvc.present_toast("wallet account_id is invalid. Please login and wait 3 seconds.","top","bg-danger"),void e.stop_detect_receipt();let a=yield e.walletSvc.view("latest_transaction",{account:e.account_id});e.compare_receipt(e.old_receipt,a)||(e.receipt_updated=!0,e.stop_detect_receipt()),e.timeout_count+=1,e.timeout_count>e.threshold_timeout&&e.reset_if_no_pay()})()}compare_receipt(e,a){return e.datetime==a.datetime}set_old_receipt(){var e=this;return(0,w.Z)(function*(){""!==e.account_id?e.old_receipt=yield e.walletSvc.view("latest_transaction",{account:e.account_id}):e.toastSvc.present_toast("wallet account_id is invalid. Please login and wait 3 seconds.","top","bg-danger")})()}reset_if_no_pay(){this.stop_detect_receipt()}}return(t=r).\u0275fac=function(e){return new(e||t)(n.Y36(v.qu),n.Y36(Q.g),n.Y36(S),n.Y36(ee.k))},t.\u0275cmp=n.Xpm({type:t,selectors:[["app-tab1"]],decls:7,vars:3,consts:[[1,"ion-no-border"],[3,"fullscreen"],["slot","fixed",3,"ionRefresh"],[4,"ngIf"],[1,"container-center"],[1,"display-6"],[1,"bg-danger"],[1,"text-center","text-light"],["size","large",3,"color","click"],[3,"name"],[1,"container-bottom"],["novalidate","","autocomplete","off",3,"formGroup","ngSubmit"],["fill","outline","label","","formControlName","price","placeholder","0","type","number",1,"custom",3,"errorText"],[3,"qrdata","elementType","width"],["class","text-center display-4",4,"ngIf"],[1,"text-center","display-4"],["size","large","color","secondary",3,"click"],["name","receipt-outline"],[3,"checked","disabled","ionChange",4,"ngIf"],[1,"pt-3"],[3,"checked","disabled","ionChange"]],template:function(e,a){1&e&&(n.TgZ(0,"ion-header",0),n._UZ(1,"ion-toolbar"),n.qZA(),n.TgZ(2,"ion-content",1)(3,"ion-refresher",2),n.NdJ("ionRefresh",function(o){return a.handle_refresh(o)}),n._UZ(4,"ion-refresher-content"),n.qZA(),n.YNc(5,ae,4,0,"ng-container",3)(6,ge,12,7,"ng-container",3),n.qZA()),2&e&&(n.xp6(2),n.Q6J("fullscreen",!0),n.xp6(3),n.Q6J("ngIf",0===a.account_id.trim().length),n.xp6(1),n.Q6J("ngIf",0!==a.account_id.trim().length))},dependencies:[h.YG,h.W2,h.Gu,h.gu,h.pK,h.nJ,h.Wo,h.ho,h.sr,h.w,h.as,T.O5,v._Y,v.JJ,v.JL,v.sg,v.u,re],styles:["ion-input.custom[_ngcontent-%COMP%]{--padding-bottom: .7em;--padding-end: .4em;--padding-top: .7em;--border-width: 0em !important;font-size:4em;--placeholder-color: #c8c8c8 !important}"]}),r})()}];let ve=(()=>{var t;class r{}return(t=r).\u0275fac=function(e){return new(e||t)},t.\u0275mod=n.oAB({type:t}),t.\u0275inj=n.cJS({imports:[P.Bz.forChild(he),P.Bz]}),r})(),me=(()=>{var t;class r{}return(t=r).\u0275fac=function(e){return new(e||t)},t.\u0275mod=n.oAB({type:t}),t.\u0275inj=n.cJS({providers:[S],imports:[h.Pc,T.ez,v.u5,v.UX,L.e,ve,ie]}),r})()}}]);